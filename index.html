<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow - Real-time Study Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel='icon' href="favicon.ico">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <style>
        /* Base styles */
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden; /* Prevent horizontal scrolling on the entire body */
            background-color: #0d1117; /* Darker, modern background */
            background-image: radial-gradient(ellipse at top, rgba(20, 184, 166, 0.15), transparent 60%);
            color: #e6edf3; /* Brighter default text */
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-item.active, .group-nav-item.active {
            background: linear-gradient(to top, rgba(20, 184, 166, 0.2), transparent);
        }
        .nav-item.active svg, .nav-item.active p, .group-nav-item.active i, .group-nav-item.active p { 
            color: #14b8a6; /* Teal-500 */
        }

        /* Page and container visibility */
        #auth-screen, .page, #app-container, .modal { display: none; }
        #auth-screen.active, .page.active, #app-container.active, .modal.active { display: flex; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* UI element styles */
        .timer-text { font-weight: 900; letter-spacing: -0.05em; }
        
        /* Pomodoro Switch Styles */
        .timer-switch-container {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #161b22; /* Darker secondary bg */
            padding: 0.5rem;
            border-radius: 9999px;
            width: fit-content;
        }
        .timer-switch-btn {
            padding: 0.5rem 1.5rem;
            border: none;
            background-color: transparent;
            color: #9ca3af;
            font-weight: 600;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .timer-switch-btn.active {
            background-image: linear-gradient(to right, #2dd4bf, #38bdf8); /* Teal to Sky gradient */
            color: white;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.2);
        }
        #pomodoro-status {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f59e0b; /* Amber color for breaks */
            height: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Pomodoro Settings Modal Scroll Fix */
        #pomodoro-settings-modal .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2dd4bf; /* Teal-400 */
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* Volume Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #4b5563;
            border-radius: 4px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #2dd4bf; /* Teal-400 */
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
        }

        /* Group study styles */
        .group-card {
            background: #161b22; /* Darker secondary bg */
            border: 1px solid #30363d; /* Subtle border */
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            cursor: pointer;
        }
        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(45, 212, 191, 0.1); /* Teal glow */
            border-color: #2dd4bf;
        }
        .group-header {
            padding: 16px;
            background: linear-gradient(135deg, #2dd4bf 0%, #38bdf8 100%); /* Teal to Sky gradient */
            color: white;
        }
        .group-category {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
            opacity: 0.9;
        }
        .group-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .group-name .badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
        }
        .group-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.1rem; font-weight: 700; }
        .stat-label { font-size: 0.75rem; opacity: 0.8; }
        .group-body { padding: 16px; }
        .group-goal {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #374151;
        }
        .goal-text { font-weight: 600; color: white; margin-bottom: 6px; }
        .leader {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            color: #38bdf8; /* Sky-400 */
        }
        .leader i { color: gold; }
        .group-description {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .group-meta {
            display: flex;
            justify-content: space-between;
            color: #9CA3AF;
            font-size: 0.8rem;
            margin-top: 12px;
        }
        .join-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: #38bdf8; /* Sky-400 */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }
        .join-btn:hover { background: #2dd4bf; }
        .join-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .joined-badge {
            display: block;
            width: 100%;
            padding: 10px;
            background: #2dd4bf; /* Teal-400 */
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }
        .join-btn:hover { background: #4895ef; }
        .join-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .joined-badge {
            display: block;
            width: 100%;
            padding: 10px;
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 12px;
        }
        .empty-group {
            text-align: center;
            padding: 40px 20px;
            color: #9CA3AF;
        }
        .empty-group i { font-size: 3rem; color: #30363d; margin-bottom: 16px; }
        .empty-group h3 { font-size: 1.5rem; margin-bottom: 12px; color: white; }
        .empty-group p { font-size: 1rem; max-width: 500px; margin: 0 auto 20px; }
        .category-option, .time-option {
            padding: 12px;
            text-align: center;
            background: #21262d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 600;
        }
        .category-option:hover, .time-option:hover { background: #30363d; }
        .category-option.selected, .time-option.selected {
            background: #2dd4bf;
            color: white;
            border-color: #14b8a6;
        }
        .create-group-btn {
            position: fixed;
            bottom: 80px; /* Adjusted for main nav */
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(to right, #2dd4bf, #38bdf8); /* Teal to Sky gradient */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 30;
        }
        .create-group-btn:hover { background: #2dd4bf; transform: scale(1.05); }

        /* Group Ranking Styles */
        .group-filter-btn {
            padding: 6px 12px;
            background-color: transparent;
            border-radius: 6px;
            font-weight: 500;
            color: #9CA3AF;
            transition: all 0.2s;
        }
        .group-filter-btn.active {
            background-image: linear-gradient(to right, #2dd4bf, #38bdf8);
            color: white;
            box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
        }
        .group-card.ranking {
            cursor: default;
        }
        .group-card.ranking:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        /* Stats page styles */
        .stats-container { padding: 20px; }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .stat-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #E5E7EB;
        }
        
        /* Ranking page styles */
        .ranking-list { padding: 20px; }
        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .rank {
            font-weight: 700;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }
        .rank-1 { color: gold; }
        .rank-2 { color: silver; }
        .rank-3 { color: #cd7f32; }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #30363d;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .user-info { flex-grow: 1; }
        .user-name { font-weight: 600; }
        .user-time { color: #9CA3AF; font-size: 0.9rem; }
        .ranking-tab-btn {
            background-color: transparent;
            border-bottom: 2px solid transparent;
            color: #9CA3AF;
            transition: all 0.2s;
        }
        .ranking-tab-btn.active {
            color: #2dd4bf;
            border-bottom: 2px solid #2dd4bf;
        }
        
        /* Planner page styles */
        .planner-container { padding: 20px; }
        .planner-day {
            background: #161b22;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .day-header {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .planner-task {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #30363d;
        }
        .task-checkbox { margin-right: 10px; }
        .task-name { flex-grow: 1; }
        .task-name.completed { text-decoration: line-through; color: #6B7280; }
        
        /* New Planner Styles */
        #page-planner {
            /* The .active class handles display. This rule ensures the page is opaque and controls overflow. */
            background-color: #0d1117;
            overflow: hidden;
        }
        .planner-main-layout {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }
        #planner-sidebar {
            width: 250px;
            flex-shrink: 0;
            background-color: #0d1117;
            border-right: 1px solid #30363d;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease-in-out;
        }
         #planner-sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .planner-sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .planner-sidebar-item:hover {
            background-color: #30363d;
        }
        .planner-sidebar-item.active {
            background-color: #2dd4bf;
            color: white;
        }
         #planner-main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
         #planner-task-details {
            width: 350px;
            flex-shrink: 0;
            background-color: #0d1117;
            border-left: 1px solid #30363d;
            overflow-y: auto;
            transition: width 0.3s ease;
        }
        #planner-task-details.hidden {
            width: 0;
            padding: 0;
            overflow: hidden;
        }

        /* Task Item */
        .task-item {
            border-left-width: 4px;
        }

        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        .kanban-column {
            background-color: #161b22;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }
        .kanban-card {
             background-color: #21262d;
        }

        /* NEW Calendar View Styles */
        .calendar-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 1rem;
        }
        .calendar-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .calendar-nav-btn {
            background-color: #21262d;
            border: 1px solid #30363d;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-nav-btn:hover {
            background-color: #30363d;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            flex-grow: 1;
            border-top: 1px solid #30363d;
            border-left: 1px solid #30363d;
        }
        .calendar-day-header, .calendar-day-cell {
            padding: 0.5rem;
            border-right: 1px solid #30363d;
            border-bottom: 1px solid #30363d;
        }
        .calendar-day-header {
            text-align: center;
            font-weight: 500;
            color: #9ca3af;
            font-size: 0.875rem;
        }
        .calendar-day-cell {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            transition: background-color 0.2s;
        }
        .calendar-day-cell:not(.other-month):hover {
            background-color: #161b22;
        }
        .day-number {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        .day-number.today {
            background: linear-gradient(to right, #2dd4bf, #38bdf8);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .calendar-day-cell.other-month .day-number {
            color: #6b7280;
        }
        .calendar-tasks-container {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .calendar-task {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.2s;
        }
        .calendar-task:hover {
            opacity: 0.8;
        }
        .calendar-task.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }
        .calendar-task.priority-high { background-color: #ef4444; }
        .calendar-task.priority-medium { background-color: #f59e0b; }
        .calendar-task.priority-low { background-color: #3b82f6; }
        .calendar-task.priority-none { background-color: #6b7280; }
        
        /* Planner Responsive Adjustments */
        @media (max-width: 768px) {
            .planner-main-layout {
                flex-direction: column;
            }
            #planner-sidebar {
                position: fixed;
                top: 73px; /* Height of header */
                left: 0;
                bottom: 57px; /* Height of nav */
                height: auto;
                z-index: 40;
                transform: translateX(-100%);
            }
            #planner-sidebar.open {
                transform: translateX(0);
            }
            #planner-task-details {
                position: fixed;
                top: 73px;
                right: 0;
                bottom: 57px;
                height: auto;
                width: 85%;
                max-width: 350px;
                z-index: 40;
                transform: translateX(100%);
                border-left: 1px solid #374151;
            }
            #planner-task-details.open {
                transform: translateX(0);
            }
            #planner-task-details.hidden {
                transform: translateX(100%);
            }
            .kanban-board {
                display: flex;
                overflow-x: auto;
                padding-bottom: 1rem;
            }
            .kanban-column {
                min-width: 280px;
                flex-shrink: 0;
            }
            .calendar-grid {
                gap: 2px;
            }
            .calendar-cell {
                min-height: 80px;
                padding: 4px;
            }
        }

        /* New Planner List View Styles */
        #planner-list-view-container {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: #0d1117; /* Match page bg */
        }
        .planner-search-bar {
            position: relative;
            margin-bottom: 1rem;
        }
        .planner-search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        .planner-search-bar input {
            width: 100%;
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            color: white;
            font-size: 1rem;
            outline: none;
        }
        .planner-search-bar input::placeholder {
            color: #9ca3af;
        }
        .planner-list-section {
            flex-grow: 1;
            overflow-y: auto;
        }
        .planner-list-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .planner-list-item:hover {
            background-color: #21262d;
        }
        .planner-list-item .icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
            flex-shrink: 0;
        }
        .planner-list-item .icon i {
            font-size: 0.9rem;
        }
        .planner-list-item .text {
            flex-grow: 1;
            font-weight: 500;
            font-size: 1rem;
        }
        .planner-list-item .counts {
            color: #9ca3af;
            font-size: 0.9rem;
        }
        .planner-actions {
            padding: 1rem 0.5rem 0;
            border-top: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .planner-add-project-btn {
            background: none;
            border: none;
            color: #ef4444;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            cursor: pointer;
        }
        .planner-add-project-btn i {
            font-size: 1.25rem;
        }
        .planner-actions .action-icons {
            display: flex;
            gap: 1.25rem;
            color: #9ca3af;
            font-size: 1.1rem;
        }
        .planner-actions .action-icons i {
            cursor: pointer;
        }

        /* New Planner Category View Styles */
        .planner-category-view {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: #0d1117;
        }
        .category-view-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #30363d;
            flex-shrink: 0;
        }
        .category-back-btn {
            margin-right: 1rem;
        }
        .category-view-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .category-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #30363d;
            flex-shrink: 0;
        }
        @media (min-width: 640px) {
            .category-stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        .category-stat-card {
            text-align: center;
        }
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #ef4444; /* Red color from image */
        }
        .stat-label {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        .category-add-task-container {
            padding: 1rem;
            flex-shrink: 0;
        }
        .add-task-input-wrapper {
            display: flex;
            align-items: center;
            background-color: #161b22;
            border-radius: 0.75rem;
            padding: 0.5rem 1rem;
        }
        .add-task-input-wrapper i {
            color: #9ca3af;
            margin-right: 0.75rem;
        }
        .category-add-task-input {
            background: transparent;
            border: none;
            outline: none;
            color: white;
            width: 100%;
            font-size: 1rem;
            padding: 0.5rem 0;
        }
        .category-task-list-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 1rem 1rem;
        }
        .no-tasks-placeholder {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }
        .no-tasks-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .no-tasks-placeholder h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #d1d5db;
        }
        .category-task-item {
            display: flex;
            align-items: center;
            background-color: #161b22;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        .task-checkbox-category {
            width: 24px;
            height: 24px;
            border: 2px solid #ef4444;
            border-radius: 50%;
            margin-right: 1rem;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .task-checkbox-category.completed {
            background-color: #ef4444;
            border-color: #ef4444;
        }
        .category-task-item.completed .task-title-category {
            text-decoration: line-through;
            color: #6b7280;
        }
        .task-title-category {
            flex-grow: 1;
            font-weight: 500;
        }
        .task-play-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: transparent;
            border: 2px solid #ef4444;
            color: #ef4444;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .task-play-btn:hover {
            background-color: #ef4444;
            color: white;
        }
        .completed-tasks-toggle {
            text-align: center;
            padding: 0.5rem;
            cursor: pointer;
            color: #9ca3af;
            font-size: 0.875rem;
        }


        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(13, 17, 23, 0.7); /* Darker backdrop */
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #0d1117;
            border: 1px solid transparent;
            border-image: linear-gradient(to bottom right, #14B8A6, #0EA5E9);
            border-image-slice: 1;
            box-shadow: 0 0 30px rgba(14, 165, 233, 0.1);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title { font-size: 1.3rem; font-weight: 600; }
        .close-modal {
            background: none;
            border: none;
            color: #9CA3AF;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Profile Settings */
        .profile-container { padding: 20px; }
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #30363d;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            position: relative;
            overflow: hidden; /* To contain the image */
        }
        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-name { font-size: 1.3rem; font-weight: 600; }
        .profile-email { color: #9CA3AF; }
        .settings-item {
            padding: 15px 0;
            border-bottom: 1px solid #30363d;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .settings-item:hover {
            background-color: rgba(48, 54, 61, 0.3);
        }
        .settings-label { font-weight: 600; margin-bottom: 5px; }
        .settings-value { color: #9CA3AF; }
        
        /* Loading spinner */
        .fa-spinner { animation: spin 1s linear infinite; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive fixes */
        @media (max-width: 640px) {
            .group-card { margin-bottom: 1rem; }
            .group-stats { flex-direction: column; gap: 0.5rem; }
            .stat-item { display: flex; justify-content: space-between; align-items: center; }
            .create-group-btn { bottom: 70px; right: 15px; }
            #session-timer { font-size: 4rem; }
        }
        .subject-color-picker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(32px, 1fr)); /* Responsive grid */
            gap: 8px; /* Space between dots */
        }
        .subject-color-picker .color-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            outline: 2px solid transparent;
            transition: outline-color 0.2s, transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Subtle shadow */
        }
        .subject-color-picker .color-dot:hover {
            transform: scale(1.1); /* Pop effect on hover */
        }
        .subject-color-picker .color-dot.selected {
            outline-color: #3B82F6; /* Blue outline for selected */
            transform: scale(1.05); /* Slightly larger when selected */
        }
        .subject-item {
            cursor: grab; /* Indicate draggable */
            border: 2px solid #374151;
            position: relative; /* For options menu positioning */
            transition: all 0.2s ease; /* Smooth transitions for drag feedback */
        }
        .subject-item.selected {
            border-color: #3B82F6;
            background-color: #2563eb30;
        }
        .subject-item.dragging {
            opacity: 0.5;
            border: 2px dashed #3B82F6;
            background-color: #2563eb10;
        }
        .subject-item.drag-over {
            border: 2px solid #10B981; /* Green border for drag over target */
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        .subject-options-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
            padding: 5px;
        }
        .subject-options-menu {
            display: none;
            position: absolute;
            right: 25px;
            top: 25px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 10;
            overflow: hidden; /* Ensure buttons don't spill */
        }
        .subject-options-menu.active {
            display: block;
        }
        .subject-options-menu button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            text-align: left;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }
        .subject-options-menu button:hover {
            background-color: #30363d;
        }
        .subject-options-menu .delete-btn:hover {
            background-color: #ef4444;
        }
        /* Group Detail Page */
        .member-list-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 0.75rem;
            width: 100%;
        }
        .member-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: #4B5563;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            position: relative;
            flex-shrink: 0;
        }
        .member-avatar.studying {
            outline: 3px solid #10B981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }
        .member-status-icon {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 20px;
            height: 20px;
            background-color: #10B981;
            border-radius: 50%;
            border: 3px solid #1F2937;
        }
        .member-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .member-time {
            color: #9CA3AF;
            font-size: 0.9rem;
        }
        #group-detail-nav {
            display: none;
        }
        .chat-message {
            margin-bottom: 1rem;
            display: flex;
        }
        .chat-message.sent {
            justify-content: flex-end;
        }
        .chat-bubble {
            max-width: 75%;
            padding: 0.75rem;
            border-radius: 1rem;
        }
        .chat-bubble.sent {
            background-color: #3B82F6;
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-bubble.received {
            background-color: #21262d;
            color: white;
            border-bottom-left-radius: 0.25rem;
        }
        .chat-sender {
            font-size: 0.75rem;
            color: #9CA3AF;
            margin-bottom: 0.25rem;
        }

        /* Attendance Page Styles */
        .attendance-container {
            padding: 16px;
        }
        .attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .attendance-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #21262d;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .attendance-nav-btn:hover {
            background: #30363d;
        }
        .attendance-title {
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
        }
        .calendar-header {
            text-align: center;
            padding: 8px;
            font-size: 0.8rem;
            color: #9CA3AF;
        }
        .calendar-day {
            aspect-ratio: 1/1;
            background: #161b22;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .calendar-day.empty {
            background: transparent;
        }
        .day-number {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .day-time {
            font-size: 0.7rem;
            color: #2dd4bf;
        }
        .calendar-day.today .day-number {
            color: #38bdf8;
            font-weight: 700;
        }
        .calendar-day.active {
            background-image: linear-gradient(to top, #2dd4bf, #38bdf8);
        }
        .calendar-day.active .day-number {
            color: white;
        }
        .calendar-day.active .day-time {
            color: white;
        }
        .attendance-stats {
            margin-top: 20px;
            padding: 16px;
            background: #161b22;
            border-radius: 12px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 12px;
        }
        .stat-box {
            background: #0d1117;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #9CA3AF;
        }
        .attendance-member-list {
            margin-top: 20px;
        }
        .member-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #161b22;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .member-avatar-sm {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #4B5563;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .member-info {
            flex-grow: 1;
        }
        .member-name-sm {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .member-time-sm {
            font-size: 0.8rem;
            color: #9CA3AF;
        }
        .attendance-progress {
            height: 6px;
            background: #374151;
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: #3B82F6;
            border-radius: 3px;
        }
        
        /* Group Settings Modal */
        .group-settings-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .group-settings-item:hover {
            background-color: #30363d;
        }
        .group-settings-item i {
            width: 20px;
            margin-right: 12px;
            color: #9CA3AF;
        }
        
        /* Edit Group Info Modal Styles */
        #edit-group-info-modal .modal-content {
            max-width: 500px;
        }
        .edit-group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: #21262d;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .edit-group-item:hover {
            background-color: #30363d;
        }
        .edit-group-item .value {
            color: #9CA3AF;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .toast {
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.info { background-image: linear-gradient(to right, #2dd4bf, #38bdf8); }
        .toast.success { background-color: #10B981; }
        .toast.error { background-color: #EF4444; }

        /* Confirmation Modal */
        #confirmation-modal .modal-content {
            text-align: center;
        }
        #confirmation-modal-message {
            margin-bottom: 20px;
            color: #D1D5DB;
        }
        #confirmation-modal-buttons {
            display: flex;
            gap: 10px;
        }
        #confirmation-modal-buttons button {
            flex-grow: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #confirm-btn { background-color: #EF4444; color: white; }
        #confirm-btn:hover { background-color: #DC2626; }
        #cancel-btn { background-color: #4B5563; color: white; }
        #cancel-btn:hover { background-color: #6B7280; }

        /* New Dashboard Styles */
        #insights-container {
            background-color: #0f172a; /* slate-900 */
            color: #f1f5f9; /* slate-100 */
        }
        .card {
            background-color: #1e293b; /* slate-800 */
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid #334155; /* slate-700 */
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(45, 212, 191, 0.1);
        }
        .nav-btn {
            padding: 0.5rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .nav-btn.active {
            background-color: #2dd4bf; /* Teal-400 */
            color: #0d1117;
            box-shadow: 0 0 15px rgba(45, 212, 191, 0.5);
        }
        .nav-btn:not(.active) {
            background-color: #334155; /* slate-700 */
            color: #cbd5e1; /* slate-300 */
        }
        .nav-btn:not(.active):hover {
            background-color: #475569; /* slate-600 */
        }
        .view {
            display: none;
        }
        .view.active {
            display: grid;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .session-log-item {
            position: relative;
        }
        .log-options-menu {
            display: none;
            position: absolute;
            right: 1rem;
            top: 2.5rem;
            background-color: #334155;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 20;
            overflow: hidden;
        }
        .log-options-menu.active {
            display: block;
        }
        .log-options-menu button {
            display: block;
            width: 100%;
            padding: 0.5rem 1rem;
            text-align: left;
            color: #f1f5f9;
        }
        .log-options-menu button:hover {
            background-color: #475569;
        }
        #pull-to-refresh {
            text-align: center;
            padding: 10px;
            color: #94a3b8;
            transition: height 0.3s ease;
            overflow: hidden;
            height: 0;
        }

        /* New Group Study Button */
        #group-study-timer-btn {
            background-color: #1f2937;
            color: #9ca3af;
            font-weight: 600;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: fit-content;
            margin: 1rem auto 0; /* Center it below the switch */
            padding: 0.5rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #group-study-timer-btn:hover {
            background-image: linear-gradient(to right, #2dd4bf, #38bdf8);
            color: white;
            box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
        }

        /* Group Detail Header Dropdown */
        .group-detail-header-dropdown {
            position: relative;
            display: inline-block;
        }

        .group-detail-header-dropdown select {
            background-color: #161b22;
            color: white;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 1rem;
            font-weight: 600;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 30px; /* Space for arrow */
            cursor: pointer;
            outline: none;
        }

        .group-detail-header-dropdown::after {
            content: 'â–¼';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
            pointer-events: none;
        }

        /* Avatar Selection Styles */
        .avatar-picker {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .avatar-option {
            position: relative;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        .avatar-option.selected {
            border-color: #2dd4bf; /* Teal-400 */
            transform: scale(1.1);
        }
        .avatar-upload-label {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: rgba(0,0,0,0.6);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen antialiased">

    <input type="file" id="image-upload-input" class="hidden" accept="image/*">
    <input type="file" id="profile-picture-upload" class="hidden" accept="image/*">

    <div id="auth-screen" class="active flex-col items-center justify-center h-full p-4 fade-in">
        <div class="w-full max-w-sm text-center">
             <div class="flex items-center justify-center mb-6">
                 <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                     <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" fill="url(#paint0_linear_logo)"></path>
                     <path d="M9 8H15V10H11V12H14V14H11V16H9V8Z" fill="white"></path>
                     <defs>
                         <linearGradient id="paint0_linear_logo" x1="2" y1="12" x2="22" y2="12" gradientUnits="userSpaceOnUse">
                             <stop stop-color="#14B8A6"></stop>
                             <stop offset="1" stop-color="#0EA5E9"></stop>
                         </linearGradient>
                     </defs>
                 </svg>
                 <span class="text-4xl font-bold ml-3 bg-clip-text text-transparent bg-gradient-to-r from-teal-400 to-sky-400">FocusFlow</span>
             </div>
             <p class="text-gray-400 mb-8">Your Ultimate Study Companion</p>
             <div id="auth-form-container" class="bg-gray-800 p-8 rounded-2xl shadow-lg">
                 <form id="login-form" class="space-y-4">
                     <h2 class="text-2xl font-bold text-white mb-4">Login</h2>
                     <input type="email" id="login-email" placeholder="Email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                     <input type="password" id="login-password" placeholder="Password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                     <button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Sign In</button>
                 </form>
                 <form id="signup-form" class="hidden space-y-4">
                     <h2 class="text-2xl font-bold text-white mb-4">Create Account</h2>
                     <input type="email" id="signup-email" placeholder="Email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                     <input type="password" id="signup-password" placeholder="Password (min. 6 characters)" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required minlength="6">
                     <button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Sign Up</button>
                 </form>
                 <p id="auth-error" class="text-red-400 text-sm mt-4 h-5"></p>
                 <div class="flex items-center my-6">
                     <hr class="flex-grow border-gray-600">
                     <span class="mx-4 text-gray-500">OR</span>
                     <hr class="flex-grow border-gray-600">
                 </div>
                 <button id="google-signin-btn" class="w-full bg-white text-gray-800 font-semibold py-3 rounded-lg flex items-center justify-center transition hover:bg-gray-200">
                     <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48">
                         <path fill="#4285F4" d="M43.611 20.083H24v8.838h11.002c-0.463 2.878-2.18 5.424-4.852 7.199l7.217 5.626C43.02 37.21 46 29.54 46 20.083z"/>
                         <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.897-5.781l-7.217-5.626c-2.13 1.442-4.852 2.308-7.68 2.308-5.878 0-10.845-3.965-12.624-9.26l-7.42 5.781C6.383 39.04 14.46 48 24 48z"/>
                         <path fill="#FBBC05" d="M11.376 28.71c-0.565-1.71-0.565-3.526 0-5.236l-7.42-5.781C1.678 21.24 0 26.52 0 32.14c0 5.62 1.678 10.9 4.053 14.18l7.323-5.61z"/>
                         <path fill="#EA4335" d="M24 10.73c3.52 0 6.565 1.218 9.015 3.655l6.345-6.345C35.93 2.13 30.48 0 24 0 14.46 0 6.383 8.96 2.053 17.71l7.42 5.781c1.779-5.295 6.746-9.26 12.624-9.26z"/>
                     </svg>
                     Sign in with Google
                 </button>
                 
                 <button id="anonymous-signin-btn" class="w-full mt-4 bg-gray-600 text-white font-semibold py-3 rounded-lg flex items-center justify-center transition hover:bg-gray-500">
                    <i class="fas fa-user-secret mr-3"></i>
                    Continue as Guest
                 </button>
                 <p class="mt-8 text-sm text-gray-400">
                     <span id="login-toggle-text">Don't have an account?</span>
                     <button id="auth-toggle-btn" class="font-semibold text-blue-400 hover:text-blue-300">Sign Up</button>
                 </p>
             </div>
        </div>
    </div>

    <div id="page-username-setup" class="page flex-col items-center justify-center h-full p-4 fade-in">
        <div class="w-full max-w-sm text-center">
            <h1 class="text-3xl font-bold text-white mb-2">Welcome to FocusFlow!</h1>
            <p class="text-gray-400 mb-8">Let's set up your profile.</p>
            <div class="bg-gray-800 p-8 rounded-2xl shadow-lg">
                <form id="username-setup-form" class="space-y-4">
                    <div class="avatar-picker" id="username-avatar-picker">
                        </div>
                    <input type="text" id="username-input" placeholder="Enter your username" class="w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required minlength="3">
                    <p id="username-error" class="text-red-400 text-sm h-5"></p>
                    <button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Save Profile</button>
                </form>
            </div>
        </div>
    </div>

    <div id="app-container" class="flex-col h-screen">
        <main class="flex-grow overflow-y-auto no-scrollbar">
            <div id="page-timer" class="page active flex-col h-full">
                <header class="p-4 md:p-6 flex items-center justify-between z-20">
                     <div class="flex items-center">
                         <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                             <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" fill="url(#paint0_linear_logo_header)"></path>
                             <path d="M9 8H15V10H11V12H14V14H11V16H9V8Z" fill="white"></path>
                             <defs>
                                 <linearGradient id="paint0_linear_logo_header" x1="2" y1="12" x2="22" y2="12" gradientUnits="userSpaceOnUse">
                                     <stop stop-color="#14B8A6"></stop>
                                     <stop offset="1" stop-color="#0EA5E9"></stop>
                                 </linearGradient>
                             </defs>
                         </svg>
                         <span class="text-2xl font-bold ml-2 bg-clip-text text-transparent bg-gradient-to-r from-teal-400 to-sky-400">FocusFlow</span>
                     </div>
                     <div class="flex items-center space-x-4">
                         <button id="groups-btn" class="w-10 h-10 rounded-full bg-sky-900/50 border border-sky-800 flex items-center justify-center text-gray-400 hover:bg-sky-800/60 transition">
                             <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                 <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                             </svg>
                         </button>
                         <button id="profile-btn" class="w-10 h-10 rounded-full bg-sky-900/50 border border-sky-800 flex items-center justify-center text-gray-400 hover:bg-sky-800/60 transition overflow-hidden">
                             <div id="header-avatar" class="w-full h-full flex items-center justify-center bg-blue-500 text-white font-bold">U</div>
                         </button>
                     </div>
                </header>
                <div class="relative flex-grow flex items-center justify-center -mt-16">
                    <div class="relative text-center z-10 bg-gray-900/50 backdrop-blur-sm p-4 sm:p-8 rounded-full">
                        <div class="timer-switch-container mx-auto mb-4">
                            <button id="normal-timer-btn" class="timer-switch-btn active">Normal</button>
                            <button id="pomodoro-timer-btn" class="timer-switch-btn">Pomodoro</button>
                        </div>
                        <button id="group-study-timer-btn" class="text-sm">
                            <i class="fas fa-users-line"></i> Group Study
                        </button>
                        <p id="active-subject-display" class="text-xl font-semibold text-blue-400 h-7 mb-2"></p>
                        <p id="pomodoro-status"></p>
                        <h2 id="session-timer" class="text-7xl md:text-8xl timer-text text-white">00:00:00</h2>
                        <p id="total-time-display" class="text-gray-400 mt-2">Total Today: 00:00:00</p>
                        <p id="total-break-time-display" class="text-gray-400 mt-1">Total Break: 00:00:00</p>
                        <div id="timer-controls" class="mt-8">
                            <button id="start-studying-btn" class="bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-4 px-8 rounded-full text-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Start Studying</button>
                            <button id="stop-studying-btn" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-10 rounded-full text-lg transition-transform transform hover:scale-105">Stop</button>
                            <button id="manual-start-btn" class="hidden bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-full text-lg transition-transform transform hover:scale-105">Start Next</button>
                            <button id="pause-btn" class="hidden bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-10 rounded-full text-lg transition-transform transform hover:scale-105">Pause</button>
                            <button id="resume-btn" class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full text-lg transition-transform transform hover:scale-105">Resume</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="page-stats" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="timer">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">Stats & Insights</h1>
                    <div class="w-6"></div> 
                </header>
                <div id="insights-container" class="p-4 md:p-6 bg-[#0d1117]">
                    </div>
            </div>
            
            <div id="page-ranking" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="timer">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">Leaderboard</h1>
                    <div class="w-6"></div> </header>
                <div class="px-4 pt-4">
                    <div class="flex space-x-1" id="ranking-period-tabs">
                        <button class="ranking-tab-btn flex-1 py-2 px-4 rounded-t-lg font-semibold text-sm" data-period="daily">Daily</button>
                        <button class="ranking-tab-btn flex-1 py-2 px-4 rounded-t-lg font-semibold text-sm active" data-period="weekly">Last 7 Days</button>
                        <button class="ranking-tab-btn flex-1 py-2 px-4 rounded-t-lg font-semibold text-sm" data-period="monthly">Last 30 Days</button>
                    </div>
                </div>
                <div id="ranking-list" class="ranking-list">
                                    </div>
            </div>
            
            <div id="page-planner" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="timer">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                     <div class="flex items-center gap-2">
                         <button id="planner-menu-toggle" class="p-2 rounded-full hover:bg-gray-700 md:hidden"><i class="fas fa-bars"></i></button>
                         <h1 id="planner-header-title" class="text-xl font-bold text-gray-100">Planner</h1>
                     </div>
                    <div id="planner-view-controls" class="flex items-center bg-gray-700 rounded-md p-1">
                         <button data-view="list" class="planner-view-btn p-1 px-2 rounded text-sm"><i class="fas fa-list mr-1"></i>List</button>
                         <button data-view="board" class="planner-view-btn p-1 px-2 rounded text-sm"><i class="fas fa-grip-horizontal mr-1"></i>Board</button>
                         <button data-view="calendar" class="planner-view-btn p-1 px-2 rounded text-sm"><i class="fas fa-calendar-alt mr-1"></i>Calendar</button>
                    </div>
                </header>
                <div class="planner-main-layout">
                    <aside id="planner-sidebar"></aside>
                    <main id="planner-main-content">
                        </main>
                    <aside id="planner-task-details" class="hidden">
                        </aside>
                </div>
            </div>

            <div id="page-profile" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="timer">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">Profile & Settings</h1>
                    <div class="w-6"></div> 
                </header>
                <div class="profile-container">
                    <div id="profile-authenticated-view">
                        <div class="profile-header">
                            <div id="profile-page-avatar" class="profile-avatar bg-blue-500">
                                 </div>
                            <div>
                                <div id="profile-page-name" class="profile-name">User Name</div>
                                <div id="profile-page-email" class="profile-email">user@example.com</div>
                            </div>
                        </div>
                        <div class="card text-center p-4 bg-yellow-500/10 border-yellow-500/30 mb-6 rounded-lg">
                            <h3 class="font-bold text-lg text-yellow-400">Current Streak</h3>
                            <p class="text-4xl font-black text-white" id="profile-streak-display">0 days</p>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold mb-4">Achievements</h3>
                            <div id="achievements-grid" class="grid grid-cols-3 sm:grid-cols-4 gap-4 text-center">
                                </div>
                        </div>
                        <div id="settings-account" class="settings-item"><div class="settings-label">Account</div><div class="settings-value">Edit profile information</div></div>
                        <div id="settings-pomodoro" class="settings-item"><div class="settings-label">Pomodoro Timer</div><div class="settings-value">Customize durations & sounds</div></div>
                        <div id="settings-study-goal" class="settings-item"><div class="settings-label">Study Goals</div><div id="study-goal-value" class="settings-value">Not set</div></div>
                        <div id="sign-out-btn" class="mt-6 text-center text-red-400 font-semibold cursor-pointer py-3 bg-red-500/10 rounded-lg hover:bg-red-500/20">Sign Out</div>
                    </div>
                    
                    <div id="profile-anonymous-view" class="hidden text-center p-8">
                        <i class="fas fa-user-secret text-6xl text-gray-500 mb-4"></i>
                        <h2 class="text-2xl font-bold mb-2">You are using FocusFlow as a guest.</h2>
                        <p class="text-gray-400 mb-6">Create an account to save your progress, join groups, and access all features.</p>
                        <button id="go-to-auth-btn" class="w-full max-w-xs mx-auto bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">
                            Sign Up / Log In
                        </button>
                    </div>

                    </div>
            </div>

            <div id="page-my-groups" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="timer">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">My Groups</h1>
                    <button id="go-to-find-groups-btn" class="w-10 h-10 rounded-full flex items-center justify-center bg-gray-700 hover:bg-gray-600">
                        <i class="fas fa-search"></i>
                    </button>
                </header>
                <div id="my-groups-list" class="p-4"></div>
            </div>
            
            <div id="page-find-groups" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="my-groups">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">Group Rankings</h1>
                    <div class="w-10"></div>
                </header>
                <div class="p-4 border-b border-gray-800 sticky top-[73px] bg-gray-900 z-10">
                    <div class="flex space-x-1 bg-gray-800 p-1 rounded-lg mb-4" id="group-ranking-sort-tabs">
                        <button class="group-filter-btn flex-1" data-sort="new">New</button>
                        <button class="group-filter-btn flex-1" data-sort="attendance">Attendance</button>
                        <button class="group-filter-btn flex-1 active" data-sort="studytime">Studytime</button>
                    </div>
                    <div class="flex items-center justify-center space-x-6 text-sm" id="group-ranking-filters">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" data-filter="univ" class="w-4 h-4 bg-gray-700 rounded text-blue-500 focus:ring-blue-500 border-gray-600">
                            <span>Univ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" data-filter="available" class="w-4 h-4 bg-gray-700 rounded text-blue-500 focus:ring-blue-500 border-gray-600">
                            <span>Available</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" data-filter="public" class="w-4 h-4 bg-gray-700 rounded text-blue-500 focus:ring-blue-500 border-gray-600">
                            <span>Public</span>
                        </label>
                    </div>
                </div>
                <div id="all-groups-list" class="p-4"></div>
                <button id="go-to-create-group-btn" class="create-group-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div id="page-create-group" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center justify-between z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="find-groups">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h1 class="text-xl font-bold text-gray-100">Create New Group</h1>
                    <button id="create-group-done-btn" class="px-4 py-2 bg-gradient-to-r from-teal-500 to-sky-500 rounded-lg font-semibold text-white transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Done</button>
                </header>
                <div class="p-4 md:p-6">
                    <form id="create-group-form" class="space-y-6">
                        <div><label class="block mb-2 font-semibold">Group Name</label><input id="group-name-input" type="text" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., University Calculus" required></div>
                        <div><label class="block mb-2 font-semibold">Password (optional)</label><input id="group-password-input" type="text" class="w-full bg-gray-700 rounded-lg p-3" placeholder="Leave blank for public group"></div>
                        <div><label class="block mb-2 font-semibold">Category</label><div class="grid grid-cols-2 gap-2"><div class="category-option selected">General study</div><div class="category-option">Language study</div><div class="category-option">Secondary School</div><div class="category-option">University</div></div></div>
                        <div><label class="block mb-2 font-semibold">Time Goal</label><div class="grid grid-cols-3 gap-2"><div class="time-option selected">1</div><div class="time-option">2</div><div class="time-option">3</div><div class="time-option">4</div><div class="time-option">5</div><div class="time-option">6</div></div></div>
                        <div><label class="block mb-2 font-semibold">Capacity</label><div class="flex items-center justify-center bg-gray-700 rounded-lg p-3"><button type="button" id="decrease-capacity" class="px-4 text-xl">-</button><div id="capacity-value" class="flex-grow text-center font-bold text-lg">15</div><button type="button" id="increase-capacity" class="px-4 text-xl">+</button></div></div>
                        <div><label class="block mb-2 font-semibold">Description</label><textarea id="group-description-input" class="w-full bg-gray-700 rounded-lg p-3 h-24" placeholder="Describe your group's purpose" required></textarea></div>
                    </form>
                </div>
            </div>
            
            <div id="page-group-detail" class="page flex-col h-full overflow-y-auto no-scrollbar">
                <header class="p-4 md:p-6 flex items-center z-20 border-b border-gray-800 sticky top-0 bg-gray-900">
                    <button class="back-button text-gray-400 hover:text-white" data-target="my-groups">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <div id="group-selector-container" class="group-detail-header-dropdown">
                         <select id="group-selector"></select>
                    </div>
                    
                    <button id="group-rules-header-btn" class="ml-2 text-gray-400 hover:text-white p-2 rounded-full flex items-center justify-center hover:bg-gray-700 transition" title="Group Rules">
                        <i class="fas fa-gavel"></i>
                    </button>

                    <div class="ml-auto flex items-center gap-2">
                        <div id="ranking-scope-switch" class="hidden timer-switch-container bg-gray-800 p-1">
                            <button id="group-ranking-scope-btn" class="timer-switch-btn text-xs px-3 py-1 active">Group</button>
                            <button id="global-ranking-scope-btn" class="timer-switch-btn text-xs px-3 py-1">Global</button>
                        </div>

                        <div id="group-desktop-controls" class="hidden">
                            <div class="hidden md:flex items-center gap-2">
                                <div id="group-view-switch" class="timer-switch-container bg-gray-800 p-1">
                                    <button id="realtime-view-btn" data-view-target="realtime" class="timer-switch-btn text-xs px-3 py-1 active">Realtime</button>
                                    <button id="studicon-view-btn" data-view-target="studicon" class="timer-switch-btn text-xs px-3 py-1">Studicon</button>
                                </div>
                                <button id="studicon-store-btn" class="text-gray-400 hover:text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-700">
                                    <i class="fas fa-store"></i>
                                </button>
                                <div id="group-settings-btn-container" class="w-10 h-10"></div>
                            </div>
                        </div>
                    </div>
                </header>
                <div id="group-mobile-controls" class="md:hidden sticky top-[73px] bg-gray-900 z-10 border-b border-gray-800 p-2 flex items-center justify-between hidden">
                    <div id="group-view-switch-mobile" class="timer-switch-container bg-gray-800 p-1 m-0">
                        <button id="realtime-view-btn-mobile" data-view-target="realtime" class="timer-switch-btn text-xs px-3 py-1 active">Realtime</button>
                        <button id="studicon-view-btn-mobile" data-view-target="studicon" class="timer-switch-btn text-xs px-3 py-1">Studicon</button>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="studicon-store-btn-mobile" class="text-gray-400 hover:text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-gray-700">
                            <i class="fas fa-store"></i>
                        </button>
                        <div id="group-settings-btn-container-mobile" class="w-10 h-10">
                        </div>
                    </div>
                </div>
                <div id="group-detail-content" class="flex-grow overflow-y-auto no-scrollbar">
                </div>
                <nav id="group-detail-nav" class="bg-gray-800 border-t border-gray-700 grid grid-cols-5 sticky bottom-0">
                    <button class="group-nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors active" data-subpage="home">
                        <i class="fas fa-home"></i>
                        <p class="text-xs mt-1">Home</p>
                    </button>
                    <button class="group-nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-subpage="attendance">
                        <i class="fas fa-calendar-check"></i>
                        <p class="text-xs mt-1">Attendance</p>
                    </button>
                    <button class="group-nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-subpage="rankings">
                        <i class="fas fa-chart-bar"></i>
                        <p class="text-xs mt-1">Rankings</p>
                    </button>
                    <button class="group-nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-subpage="invite">
                        <i class="fas fa-user-plus"></i>
                        <p class="text-xs mt-1">Invite</p>
                    </button>
                    <button class="group-nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-subpage="chat">
                        <i class="fas fa-comments"></i>
                        <p class="text-xs mt-1">Chat</p>
                    </button>
                </nav>
            </div>
        </main>
        <nav id="main-nav" class="bg-gray-800 border-t border-gray-700 grid grid-cols-5 sticky bottom-0">
            <button class="nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors active" data-page="timer"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><p class="text-xs mt-1">Timer</p></button>
            <button class="nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-page="stats"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg><p class="text-xs mt-1">Stats</p></button>
            <button class="nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-page="ranking"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg><p class="text-xs mt-1">Ranking</p></button>
            <button class="nav-item p-3 flex flex-col items-center justify-center text-gray-400 hover:bg-gray-700 transition-colors" data-page="planner"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg><p class="text-xs mt-1">Planner</p></button>
            <button id="add-subject-btn" class="p-3 flex flex-col items-center justify-center text-sky-400 hover:bg-gray-700 transition-colors"><svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><p class="text-xs mt-1">Add Subject</p></button>
        </nav>
    </div>

    <div id="toast-container"></div>
    <div id="add-subject-modal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Add New Subject</div><button class="close-modal">&times;</button></div><form id="add-subject-form"><div class="mb-4"><label for="add-subject-name" class="block text-gray-300 mb-2">Subject Name</label><input type="text" id="add-subject-name" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required></div><div class="mb-4"><label class="block text-gray-300 mb-2">Color</label><div class="subject-color-picker"><div class="color-dot bg-red-500" data-color="bg-red-500"></div><div class="color-dot bg-blue-500 selected" data-color="bg-blue-500"></div><div class="color-dot bg-green-500" data-color="bg-green-500"></div><div class="color-dot bg-yellow-500" data-color="bg-yellow-500"></div><div class="color-dot bg-purple-500" data-color="bg-purple-500"></div><div class="color-dot bg-pink-500" data-color="bg-pink-500"></div><div class="color-dot bg-indigo-500" data-color="bg-indigo-500"></div><div class="color-dot bg-teal-500" data-color="bg-teal-500"></div><div class="color-dot bg-orange-500" data-color="bg-orange-500"></div><div class="color-dot bg-cyan-500" data-color="bg-cyan-500"></div><div class="color-dot bg-lime-500" data-color="bg-lime-500"></div><div class="color-dot bg-fuchsia-500" data-color="bg-fuchsia-500"></div><div class="color-dot bg-rose-500" data-color="bg-rose-500"></div><div class="color-dot bg-sky-500" data-color="bg-sky-500"></div><div class="color-dot bg-emerald-500" data-color="bg-emerald-500"></div><div class="color-dot bg-amber-500" data-color="bg-amber-500"></div><div class="color-dot bg-violet-500" data-color="bg-violet-500"></div></div></div><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Add Subject</button></form></div></div>
    <div id="start-session-modal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Start New Session</div><button id="close-start-session-modal" class="close-modal">&times;</button></div><form id="start-session-form"><div id="subject-selection-list" class="mb-4 max-h-60 overflow-y-auto space-y-2"></div><div class="flex items-center gap-4 mt-4"><button type="button" id="open-add-subject-modal-from-start" class="w-full text-center py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-medium transition">Add New Subject</button><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Start Timer</button></div></form></div></div>
    <div id="add-task-modal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Add New Task</div><button class="close-modal">&times;</button></div><form id="add-task-form"><div class="mb-4"><label for="add-task-name" class="block text-gray-300 mb-2">Task Description</label><input type="text" id="add-task-name" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required></div><div class="mb-4"><label for="add-task-date" class="block text-gray-300 mb-2">Date</label><input type="date" id="add-task-date" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required></div><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Add Task</button></form></div></div>
    <div id="password-prompt-modal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Enter Group Password</div><button class="close-modal">&times;</button></div><form id="password-prompt-form"><input type="password" id="group-password-prompt-input" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required><div class="flex gap-2 mt-4"><button type="button" class="close-modal w-full py-2 bg-gray-600 rounded-lg">Cancel</button><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-2 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Submit</button></div></form></div></div>
    <div id="confirmation-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2 id="confirmation-modal-title" class="modal-title">Are you sure?</h2><button class="close-modal">&times;</button></div><p id="confirmation-modal-message">This action cannot be undone.</p><div id="confirmation-modal-buttons"><button id="cancel-btn">Cancel</button><button id="confirm-btn">Confirm</button></div></div></div>
    
    <div id="edit-profile-modal" class="modal">
        <div class="modal-content"><div class="modal-header"><div class="modal-title">Edit Profile</div><button class="close-modal">&times;</button></div><form id="edit-profile-form"><div class="mb-4"><label for="edit-username-input" class="block text-gray-300 mb-2">Username</label><input type="text" id="edit-username-input" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required minlength="3"></div><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Save Changes</button></form></div></div>
    </div>
    
    <div id="study-goal-modal" class="modal"><div class="modal-content"><div class="modal-header"><div class="modal-title">Set Study Goal</div><button class="close-modal">&times;</button></div><form id="study-goal-form"><div class="mb-4"><label for="study-goal-input" class="block text-gray-300 mb-2">Daily Study Goal (hours)</label><input type="number" id="study-goal-input" class="w-full bg-gray-700 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-teal-400" required min="1" max="24"></div><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105">Set Goal</button></form></div></div>

    <div id="pomodoro-settings-modal" class="modal"><div class="modal-content no-scrollbar"><div class="modal-header"><div class="modal-title">Pomodoro Settings</div><button class="close-modal">&times;</button></div><form id="pomodoro-settings-form" class="space-y-4"><div class="grid grid-cols-1 gap-4"><div><label for="pomodoro-work-duration" class="block text-sm font-medium text-gray-300">Focus Duration (minutes)</label><input type="number" id="pomodoro-work-duration" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white" min="1" required></div><div><label for="pomodoro-short-break-duration" class="block text-sm font-medium text-gray-300">Short Break (minutes)</label><input type="number" id="pomodoro-short-break-duration" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white" min="1" required></div><div><label for="pomodoro-long-break-duration" class="block text-sm font-medium text-gray-300">Long Break (minutes)</label><input type="number" id="pomodoro-long-break-duration" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white" min="1" required></div><div><label for="pomodoro-long-break-interval" class="block text-sm font-medium text-gray-300">Long Break Interval (sessions)</label><input type="number" id="pomodoro-long-break-interval" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white" min="2" required></div></div><hr class="border-gray-600 my-2"><h3 class="text-lg font-semibold text-gray-200">Alarms</h3><div class="grid grid-cols-1 gap-4"><div><label for="pomodoro-volume" class="block text-sm font-medium text-gray-300">Volume</label><input type="range" id="pomodoro-volume" min="0" max="1" step="0.1" class="w-full mt-1"></div><div><label for="pomodoro-start-sound" class="block text-sm font-medium text-gray-300">Starting Bell</label><select id="pomodoro-start-sound" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white"></select></div><div><label for="pomodoro-focus-sound" class="block text-sm font-medium text-gray-300">Focus Alarm (End of Break)</label><select id="pomodoro-focus-sound" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white"></select></div><div><label for="pomodoro-break-sound" class="block text-sm font-medium text-gray-300">Break Alarm (End of Focus)</label><select id="pomodoro-break-sound" class="w-full bg-gray-700 border-gray-600 rounded-lg p-2 mt-1 text-white"></select></div></div><hr class="border-gray-600 my-2"><h3 class="text-lg font-semibold text-gray-200">Automation</h3><div class="space-y-3"> <div class="flex items-center justify-between"><span class="text-sm font-medium text-gray-300">Auto-start next focus session?</span><label class="toggle-switch"><input type="checkbox" id="pomodoro-auto-start-focus"><span class="slider"></span></label></div><div class="flex items-center justify-between"><span class="text-sm font-medium text-gray-300">Auto-start next break?</span><label class="toggle-switch"><input type="checkbox" id="pomodoro-auto-start-break"><span class="slider"></span></label></div></div><button type="submit" class="w-full bg-gradient-to-r from-teal-500 to-sky-500 text-white font-bold py-3 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-sky-500/40 hover:scale-105 mt-4">Save Settings</button></form></div></div>

    <script type="module" src="main.js"></script>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://ofysppndssyllkolxjky.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9meXNwcG5kc3N5bGxrb2x4amt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDg1MTAsImV4cCI6MjA3MjcyNDUxMH0.x6_aRXrbxSOP7I71oSooWx8x8dedczrtemoUEWiDta8';
        window.supabase = createClient(supabaseUrl, supabaseAnonKey);
    </script>
</body>
</html>
